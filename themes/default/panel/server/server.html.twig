{% extends '@EasyAdmin/page/content.html.twig' %}

{% block head_stylesheets %}
    {{ parent() }}
    {% for css in tabAssets.stylesheets %}
        <link rel="stylesheet" href="{{ template_asset(css) }}">
    {% endfor %}
{% endblock %}

{% block title %}
    | {{ serverData.pterodactylServer.name ?? 'pteroca.server.title'|trans }} #{{ server.pterodactylServerIdentifier }}
{% endblock %}

{% block content_title %}
    {{ serverData.pterodactylServer.name ?? 'pteroca.server.title'|trans }} #{{ server.pterodactylServerIdentifier }}
{% endblock %}

{% block page_actions %}
    <a class="btn btn-secondary" href="{{ path('panel') }}">
        {{ 'pteroca.system.back'|trans }}
    </a>
{% endblock %}

{% block main %}
    {% if isAdminView and app.user.email != server.user.email %}
        <div class="container mt-4 mb-4">
            <div class="alert alert-warning" role="alert">
                <i class="fas fa-exclamation-triangle"></i>
                {{ 'pteroca.server.admin_view_warning'|trans }}
            </div>
        </div>
    {% endif %}
    {% if server.isSuspended %}
        <div class="container mt-4 mb-4">
            <div class="alert alert-danger" role="alert">
                <i class="fas fa-exclamation-triangle"></i>
                {% if server.expiresAt|date("Y-m-d H:i:s") < "now"|date("Y-m-d H:i:s") %}
                    {{ 'pteroca.server.suspended_expired_hint'|trans({ '{{ expireDate }}': server.expiresAt|date("Y-m-d H:i") }) }}
                {% else %}
                    {{ 'pteroca.server.suspended_hint'|trans }}
                {% endif %}
            </div>
        </div>
    {% endif %}

    {% if serverData.isInstalling %}
        {% include 'panel/server/server_installing.html.twig' %}
    {% elseif serverData.isSuspended %}
        {% include 'panel/server/server_suspended.html.twig' %}
    {% else %}
        <div class="container mt-4">
            {% include 'panel/server/tabs/navigation.html.twig' %}
            <div class="tab-content">
                {% for tab in visibleTabs %}
                    {% include tab.template %}
                {% endfor %}
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block body_javascript %}
    {{ parent() }}
    <script>
        function sendRequest(endpointUrl, method = 'GET', data = null) {
            let requestObject = {
                method: method,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            }

            if (data) {
                requestObject.headers['Content-Type'] = 'application/json'
                requestObject.body = JSON.stringify(data)
            }

            return fetch(endpointUrl, requestObject)
        }
    </script>
    {% for js in tabAssets.javascripts %}
        <script src="{{ template_asset(js) }}"></script>
    {% endfor %}
{% endblock %}
